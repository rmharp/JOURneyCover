<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ranked Decision Voting</title>
  <style>
    /* Basic styling */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
    .voting-form {
      margin-top: 20px;
    }
    .sortable-list {
      list-style: none;
      padding: 0;
    }
    .sortable-item {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      cursor: move;
      display: flex;
      align-items: center;
    }
    .sortable-item img {
      width: 100px;
      margin-right: 20px;
    }
    .message {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ranked Decision Voting</h1>
    <form id="voteForm" class="voting-form">
      <div>
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" required>
      </div>
      <div>
        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" required>
      </div>
      <p>Drag and drop the pictures to rank them in order of preference (top = highest):</p>
      <ul id="sortable" class="sortable-list">
        <!-- Each list item represents a picture.
             The data-id attribute is used to identify the picture. -->
        <li class="sortable-item" data-id="1">
          <img src="https://via.placeholder.com/100?text=Pic1" alt="Picture 1"> Picture 1
        </li>
        <li class="sortable-item" data-id="2">
          <img src="https://via.placeholder.com/100?text=Pic2" alt="Picture 2"> Picture 2
        </li>
        <li class="sortable-item" data-id="3">
          <img src="https://via.placeholder.com/100?text=Pic3" alt="Picture 3"> Picture 3
        </li>
        <!-- Add additional pictures as needed -->
      </ul>
      <button type="submit">Submit Vote</button>
    </form>
    <div id="message" class="message"></div>
  </div>

  <!-- Include SortableJS from a CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js" 
          integrity="sha512-XePTMnqH6J/t+4JAXCys/MB5aZqj6ScTg3h5RSbxE+hv9GNWnXG6mI/hXotR/fqIjTxbebOiMGdlrsb7j0whXA==" 
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // Initialize the sortable list for drag-and-drop ranking.
    var sortable = new Sortable(document.getElementById('sortable'), {
      animation: 150
    });

    document.getElementById('voteForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Get user name inputs.
      var firstName = document.getElementById('firstName').value.trim();
      var lastName  = document.getElementById('lastName').value.trim();
      if (!firstName || !lastName) {
        document.getElementById('message').innerText = 'Please enter your first and last name.';
        return;
      }

      // Build an array representing the ranking order.
      var items = document.querySelectorAll('#sortable .sortable-item');
      var ranking = [];
      items.forEach(function(item) {
        ranking.push(item.getAttribute('data-id'));
      });

      // Create the payload to send.
      var data = {
        firstName: firstName,
        lastName: lastName,
        ranking: ranking
      };

      // Replace with your deployed Google Apps Script web app URL.
      var scriptURL = 'https://script.google.com/macros/s/AKfycbzNkKjGHInIiB4N_9SIBbmsfJuL6uY_cqQQUkMCWbpueh3eUJemh27T3u2cnE0rhAJe3A/exec';

      // Send the vote data to the Apps Script.
      // Note: Using 'no-cors' mode because Google Apps Script responses may not have CORS headers.
      fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(() => {
        // In no-cors mode, we canâ€™t read the response details.
        document.getElementById('message').innerText = 'Vote submitted successfully!';
        // Optionally, disable the form or clear the fields after submission.
      })
      .catch(error => {
        console.error('Error submitting vote:', error);
        document.getElementById('message').innerText = 'Error submitting vote. Please try again later.';
      });
    });
  </script>
</body>
</html>
